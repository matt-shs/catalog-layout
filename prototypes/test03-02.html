<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product Cards</title>
  <style>
    :root{
      --gap:10px;
      --radius:0;
      --shadow:none;
      --font:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      --font-size:13px;
      --min-card-width:100px;
    }

    body{
      font-family:var(--font);
      background:#fff;
      display:flex;
      justify-content:center;
      margin:20px;
    }

    .page-container{
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    .controls{
      margin-bottom:20px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    input[type='number']{
      width:80px;
      padding:4px;
      font-size:14px;
    }

    button{
      padding:6px 12px;
      font-size:14px;
      cursor:pointer;
    }

    .cards-container{
      display:flex;
      flex-wrap:wrap;
      gap:var(--gap);
      justify-content:flex-start;
      align-items:flex-start;
    }

    .card{
      background:#fff;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      text-align:left;
      padding:10px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
    }

    .card__image{
      width:100%;
      height:auto;
      object-fit:cover;
      margin-bottom:6px;
      display:block;
      background:#ddd;
      flex-shrink:0;
    }

    .card__body{
      line-height:1.25;
      font-size:var(--font-size);
      overflow-wrap:break-word;
      width:100%;
      display:flex;
      flex-direction:column;
    }

    .meta{
      margin:0 0 2px 0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .meta__part{
      font-weight:700;
      margin-right:8px;
    }

    .no-image{
      width:100%;
      height:100%;
      background:#ccc;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#555;
      font-size:14px;
    }
  </style>
</head>
<body>
  <div class="page-container">
    <div class="controls">
      <label for="pageWidth">Page Width (inches): </label>
      <input type="number" id="pageWidth" min="2" max="50" step="0.1" value="12">
      <label for="cardsPerRow">Cards per row: </label>
      <input type="number" id="cardsPerRow" min="1" max="12" step="1" value="5">
      <button id="exportPdf">Export PDF</button>
    </div>

    <div class="cards-container" id="cardsContainer"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const inputCardsPerRow = document.getElementById('cardsPerRow');
    const inputPageWidth = document.getElementById('pageWidth');
    const cardsContainer = document.getElementById('cardsContainer');
    const minCardWidth = 100; // px
    const inchToPx = 96;
    let cards = [];

    function createRandomCards(count){
      cardsContainer.innerHTML = '';
      cards = [];
      const relatedOptions = [1,3,4,8];

      for(let i=0; i<count; i++){
        const card = document.createElement('article');
        card.className = 'card';

        const img = document.createElement('img');
        img.className = 'card__image';
        img.src = 'http://127.0.0.1:5500/images/PWS_4.png';
        img.alt = 'Product photo';

        const noImageDiv = document.createElement('div');
        noImageDiv.className = 'no-image';
        noImageDiv.style.display = 'none';
        noImageDiv.textContent = 'No Image';

        img.onerror = function(){
          img.style.display='none';
          noImageDiv.style.display='flex';
        };

        const body = document.createElement('div');
        body.className = 'card__body';

        const pPart = document.createElement('p');
        pPart.className = 'meta';
        const span = document.createElement('span');
        span.className = 'meta__part';
        span.textContent = 'PN-' + Math.floor(Math.random()*100000);
        pPart.appendChild(span);
        pPart.appendChild(document.createTextNode(' 5x3 AL'));
        body.appendChild(pPart);

        const relatedCount = [1,3,4,8][Math.floor(Math.random()*4)];
        for(let j=0; j<relatedCount; j++){
          const p = document.createElement('p');
          p.className = 'meta';
          p.textContent = 'PN-' + Math.floor(Math.random()*100000);
          body.appendChild(p);
        }

        card.appendChild(img);
        card.appendChild(noImageDiv);
        card.appendChild(body);

        cardsContainer.appendChild(card);
        cards.push(card);
      }
    }

    function updateCardSize(){
      let cardsPerRow = parseInt(inputCardsPerRow.value) || 1;
      cardsPerRow = Math.min(cardsPerRow, 12);
      const pageWidthInches = parseFloat(inputPageWidth.value) || 12;
      const pageWidthPx = pageWidthInches * inchToPx;
      const gap = 10;
      const cardWidth = Math.max(minCardWidth, Math.floor((pageWidthPx - gap * (cardsPerRow-1)) / cardsPerRow));
      cardsContainer.style.width = pageWidthPx + 'px';

      cards.forEach(card => {
        card.style.width = cardWidth + 'px';
        const img = card.querySelector('.card__image');
        img.style.height = 'auto';
      });
    }

    inputCardsPerRow.addEventListener('input', updateCardSize);
    inputPageWidth.addEventListener('input', updateCardSize);

    createRandomCards(200);
    updateCardSize();

    document.getElementById('exportPdf').addEventListener('click', async () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'pt', 'a4');
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = pdf.internal.pageSize.getHeight();
      const scale = 5;

      const canvas = await html2canvas(cardsContainer, { scale, useCORS: true });
      const imgData = canvas.toDataURL('image/jpeg', 0.9);
      const imgProps = pdf.getImageProperties(imgData);
      const pdfHeightImg = (imgProps.height * pdfWidth) / imgProps.width;

      pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeightImg);
      pdf.save('cards.pdf');
    });
  </script>
</body>
</html>
