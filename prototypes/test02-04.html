<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Cards PDF Preview</title>
<style>
body {
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: #e2e8f0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.controls {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  justify-content: center;
}

.controls label {
  display: flex;
  flex-direction: column;
  font-size: 14px;
  font-weight: 500;
}

button {
  padding: 8px 16px;
  border-radius: 6px;
  border: none;
  background: #2563eb;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
}

#screenPreview {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.page {
  display: grid;
  gap: 12px;
  margin-bottom: 20px;
  padding: 12px;
  box-sizing: border-box;
  background: #fff;
}

@media print {
  body { background: #fff !important; }
}

.card {
  background: #fff;
  border-radius: 10px;
  padding: 10px;
  border: 1px solid #e6edf3;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  box-sizing: border-box;
}

.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-radius: 8px;
  background: #eceff1;
}

.meta { font-size: 13px; color: #0f172a; text-align: center; }
.sku { font-weight: 700; margin-bottom: 4px; }
.size { color: #475569; font-size: 13px; }
</style>
</head>
<body>

<div class="controls">
  <label>Cards per Row (1-6)
    <input type="number" id="cardsPerRow" min="1" max="6" value="3">
  </label>
  <label>Page Width (3-8.5 in)
    <input type="number" id="pageWidth" min="3" max="8.5" step="0.1" value="8.5">
  </label>
  <label>Page Height (1-11 in)
    <input type="number" id="pageHeight" min="1" max="11" step="0.1" value="11">
  </label>
  <button id="downloadPDF">Download PDF</button>
</div>

<div id="screenPreview"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
(async function(){
  const TOTAL = 60;
  const rowsPerPage = 4; // fixed rows per page
  const pxPerInch = 96;
  const screenPreview = document.getElementById('screenPreview');
  const placeholderSVG = 'data:image/svg+xml;base64,' + btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" width="600" height="400">
      <rect width="600" height="400" fill="#ddd"/>
      <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#999" font-size="40">Image</text>
    </svg>
  `);

  const items = Array.from({length: TOTAL}, (_, i) => ({
    id: i+1,
    sku: `SKU-${String(i+1).padStart(4,'0')}`,
    size: ['S','M','L','XL'][i%4],
    img: placeholderSVG
  }));

  const cardsPerRowInput = document.getElementById('cardsPerRow');
  const pageWidthInput = document.getElementById('pageWidth');
  const pageHeightInput = document.getElementById('pageHeight');
  const downloadPDFButton = document.getElementById('downloadPDF');

  function renderPages(){
    const cardsPerRow = parseInt(cardsPerRowInput.value);
    const pageWidthIn = parseFloat(pageWidthInput.value);
    const pageHeightIn = parseFloat(pageHeightInput.value);
    const pageWidthPx = pageWidthIn * pxPerInch;
    const pageHeightPx = pageHeightIn * pxPerInch;

    screenPreview.innerHTML = '';
    const cardsPerPage = cardsPerRow * rowsPerPage;
    const totalPages = Math.ceil(TOTAL / cardsPerPage);

    for(let p=0;p<totalPages;p++){
      const pageItems = items.slice(p*cardsPerPage,(p+1)*cardsPerPage);
      const pageDiv = document.createElement('div');
      pageDiv.className = 'page';
      pageDiv.style.width = pageWidthPx + 'px';
      pageDiv.style.height = pageHeightPx + 'px';
      pageDiv.style.gridTemplateColumns = `repeat(${cardsPerRow}, 1fr)`;
      pageDiv.style.gridTemplateRows = `repeat(${rowsPerPage}, 1fr)`;

      pageItems.forEach(it=>{
        const card = document.createElement('div');
        card.className = 'card';
        const img = new Image();
        img.src = it.img;
        card.appendChild(img);

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `<div class="sku">${it.sku}</div><div class="size">Size: ${it.size}</div>`;
        card.appendChild(meta);

        pageDiv.appendChild(card);
      });

      screenPreview.appendChild(pageDiv);
    }
  }

  async function waitForImages(container){
    const imgs = Array.from(container.querySelectorAll('img'));
    await Promise.all(imgs.map(img => {
      if(img.complete) return Promise.resolve();
      return new Promise(res => { img.onload = img.onerror = res; });
    }));
  }

  async function generatePDF(){
    const { jsPDF } = window.jspdf;
    const cardsPerRow = parseInt(cardsPerRowInput.value);
    const pageWidthIn = parseFloat(pageWidthInput.value);
    const pageHeightIn = parseFloat(pageHeightInput.value);

    const pdf = new jsPDF({ unit:'in', format:[pageWidthIn,pageHeightIn] });

    const pages = Array.from(screenPreview.children);
    for(let i=0;i<pages.length;i++){
      const pageDiv = pages[i];
      await waitForImages(pageDiv);
      const canvas = await html2canvas(pageDiv, { scale:2, useCORS:true });
      const imgData = canvas.toDataURL('image/png');
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pageWidthIn;
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

      if(i>0) pdf.addPage();
      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
    }

    pdf.save('cards.pdf');
  }

  cardsPerRowInput.addEventListener('change', renderPages);
  pageWidthInput.addEventListener('change', renderPages);
  pageHeightInput.addEventListener('change', renderPages);
  downloadPDFButton.addEventListener('click', generatePDF);

  renderPages();

})();
</script>

</body>
</html>
