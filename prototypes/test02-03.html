<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>60 Cards PDF Preview with Placeholder</title>
<style>
body {
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: #e2e8f0; /* slightly darker background outside pages */
  display: flex;
  flex-direction: column;
  align-items: center;
}

button {
  margin-bottom: 20px;
  padding: 8px 16px;
  border-radius: 6px;
  border: none;
  background: #2563eb;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
}

/* Page container */
.page {
  width: 816px; /* 8.5in × 96px */
  height: 1056px; /* 11in × 96px */
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 20px;
  padding: 12px;
  box-sizing: border-box;
  background: #fff;
}

@media print {
  body { background: #fff !important; } /* ensure PDF has white background */
}

.card {
  background: #fff;
  border-radius: 10px;
  padding: 10px;
  border: 1px solid #e6edf3;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  box-sizing: border-box;
}

.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-radius: 8px;
  background: #eceff1;
}

.meta { font-size: 13px; color: #0f172a; text-align: center; }
.sku { font-weight: 700; margin-bottom: 4px; }
.size { color: #475569; font-size: 13px; }
</style>
</head>
<body>

<button id="downloadPDF">Download PDF</button>
<div id="screenPreview"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
(async function(){
  const TOTAL = 60;
  const cardsPerRow = 3;
  const rowsPerPage = 4;
  const cardsPerPage = cardsPerRow * rowsPerPage;
  const pageWidthIn = 8.5;
  const pageHeightIn = 11;
  const pxPerInch = 96;

  const screenPreview = document.getElementById('screenPreview');

  // Placeholder SVG
  const placeholderSVG = 'data:image/svg+xml;base64,' + btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" width="600" height="400">
      <rect width="600" height="400" fill="#ddd"/>
      <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#999" font-size="40">Image</text>
    </svg>
  `);

  // Create card data
  const items = Array.from({length: TOTAL}, (_, i) => ({
    id: i+1,
    sku: `SKU-${String(i+1).padStart(4,'0')}`,
    size: ['S','M','L','XL'][i%4],
    img: placeholderSVG
  }));

  // Split into pages
  const totalPages = Math.ceil(TOTAL / cardsPerPage);
  const pageElements = [];

  for(let p = 0; p < totalPages; p++){
    const pageItems = items.slice(p*cardsPerPage, (p+1)*cardsPerPage);
    const pageDiv = document.createElement('div');
    pageDiv.className = 'page';

    pageItems.forEach(it => {
      const card = document.createElement('div');
      card.className = 'card';
      const img = new Image();
      img.src = it.img;
      card.appendChild(img);

      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.innerHTML = `<div class="sku">${it.sku}</div><div class="size">Size: ${it.size}</div>`;
      card.appendChild(meta);

      pageDiv.appendChild(card);
    });

    screenPreview.appendChild(pageDiv);
    pageElements.push(pageDiv);
  }

  async function waitForImages(container){
    const imgs = Array.from(container.querySelectorAll('img'));
    await Promise.all(imgs.map(img => {
      if(img.complete) return Promise.resolve();
      return new Promise(res => { img.onload = img.onerror = res; });
    }));
  }

  document.getElementById('downloadPDF').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ unit:'in', format:[pageWidthIn, pageHeightIn] });

    for(let i=0; i<pageElements.length; i++){
      const pageDiv = pageElements[i];
      await waitForImages(pageDiv);
      const canvas = await html2canvas(pageDiv, { scale:2, useCORS:true });
      const imgData = canvas.toDataURL('image/png');
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pageWidthIn;
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

      if(i>0) pdf.addPage();
      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
    }

    pdf.save('cards.pdf');
  });

})();
</script>

</body>
</html>
